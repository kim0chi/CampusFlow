@model List<StudentEnrollmentSystem.Models.EnrollmentBatch>
@{
    ViewData["Title"] = "My Enrollments";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="bi bi-journal-text"></i> My Enrollment History</h2>
    <a asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Enroll in Courses
    </a>
</div>
<hr />

@if (Model.Any())
{
    <div class="row">
        @foreach (var batch in Model)
        {
            <div class="col-md-6 mb-4">
                <div class="card @(batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Enrolled ? "border-success" : batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Rejected ? "border-danger" : "border-warning")">
                    <div class="card-header @(batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Enrolled ? "bg-success text-white" : batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Rejected ? "bg-danger text-white" : "bg-warning")">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">
                                    <i class="bi bi-calendar3"></i> @batch.Semester @batch.AcademicYear
                                </h5>
                                <small>Batch #@batch.Id - Submitted: @batch.SubmittedDate.ToLocalTime().ToString("MMM dd, yyyy")</small>
                            </div>
                            <div>
                                @if (batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Enrolled)
                                {
                                    <span class="badge bg-light text-success"><i class="bi bi-check-circle-fill"></i> @batch.Status</span>
                                }
                                else if (batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.Rejected)
                                {
                                    <span class="badge bg-light text-danger"><i class="bi bi-x-circle-fill"></i> @batch.Status</span>
                                }
                                else
                                {
                                    <span class="badge bg-light text-dark"><i class="bi bi-clock-history"></i> @batch.Status</span>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <strong><i class="bi bi-book"></i> Courses:</strong> @batch.Enrollments.Count
                            </div>
                            <div class="col-6">
                                <strong><i class="bi bi-star"></i> Credits:</strong> <span class="badge bg-primary">@batch.TotalCredits</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <strong>Courses in this batch:</strong>
                            <ul class="list-unstyled mt-2">
                                @foreach (var enrollment in batch.Enrollments.OrderBy(e => e.Course.CourseCode).Take(3))
                                {
                                    <li>
                                        <i class="bi bi-mortarboard"></i>
                                        <strong>@enrollment.Course.CourseCode</strong> - @enrollment.Course.Name
                                        <span class="text-muted">(@enrollment.Course.Credits cr)</span>
                                    </li>
                                }
                                @if (batch.Enrollments.Count > 3)
                                {
                                    <li class="text-muted"><em>... and @(batch.Enrollments.Count - 3) more course(s)</em></li>
                                }
                            </ul>
                        </div>

                        @if (!string.IsNullOrEmpty(batch.StudentComments))
                        {
                            <div class="alert alert-light mb-3">
                                <small><strong>Your comments:</strong> @batch.StudentComments</small>
                            </div>
                        }

                        @if (batch.CompletedDate.HasValue)
                        {
                            <div class="text-muted">
                                <small><i class="bi bi-check-circle"></i> Completed: @batch.CompletedDate.Value.ToLocalTime().ToString("MMM dd, yyyy")</small>
                            </div>
                        }
                    </div>
                    <div class="card-footer">
                        <a asp-action="Details" asp-route-id="@batch.Id" class="btn btn-sm btn-info">
                            <i class="bi bi-eye"></i> View Details
                        </a>
                        @if (batch.Status == StudentEnrollmentSystem.Models.Enums.EnrollmentStatus.AwaitingPayment)
                        {
                            <a asp-controller="StudentAccount" asp-action="MakePayment" asp-route-enrollmentId="@batch.Id" class="btn btn-sm btn-success">
                                <i class="bi bi-cash"></i> Make Payment
                            </a>
                            <a asp-controller="PromissoryNote" asp-action="Submit" asp-route-enrollmentId="@batch.Id" class="btn btn-sm btn-warning">
                                <i class="bi bi-file-earmark-text"></i> Promissory Note
                            </a>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info">
        <h5><i class="bi bi-info-circle"></i> No Enrollment History</h5>
        <p>You haven't enrolled in any courses yet. Start by browsing available courses and enrolling in multiple courses at once.</p>
        <div class="mt-3">
            <a asp-controller="Course" asp-action="Browse" class="btn btn-primary">
                <i class="bi bi-search"></i> Browse Courses
            </a>
            <a asp-action="Create" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Enroll in Courses
            </a>
        </div>
    </div>
}
